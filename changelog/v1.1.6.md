# v1.1.6 更新日志

发布日期：2025-12-21

## ✨ 新功能

### 自定义 FOFA API

- **支持自定义 FOFA API 地址**：
  - 在设置页面新增"自定义 FOFA API"开关
  - 开启后可以配置自定义的 FOFA API 地址
  - 支持选择协议（HTTPS/HTTP）
  - 输入域名后自动拼接 `/api/v1` 路径
  - 实时预览完整的 API URL
  - 适用于私有部署或镜像的 FOFA 服务

## 🎨 界面优化

### FOFA 设置界面改进

- **自定义 API 配置区域**：
  - 采用折叠动画展示/隐藏配置选项
  - 协议下拉选择框 + 域名输入框 + 固定后缀的组合设计
  - 输入框后缀显示 `/api/v1`，清晰直观
  - 蓝色边框高亮显示自定义配置区域
  - 完整 URL 预览框，方便确认配置

### 设置项顺序调整

- **优化设置顺序**：
  - 自定义 FOFA API 移至最上方
  - 依次为：自定义 API → Email → API Key → 超时时间 → 绕过代理
  - 更符合配置逻辑，先配置服务器地址，再配置认证信息

### 大任务文件加载

- **修复大任务文件加载失败问题**：
  - 修复加载大型任务文件（>100MB）时出现的 JSON 解析错误
  - 添加控制字符清理机制，移除可能导致解析失败的非法字符
  - 保留合法的转义序列（如 `\n`、`\t` 等）
  - 提高大文件加载的容错性和稳定性
  - 错误信息：`Bad control character in string literal in JSON`

## 🔧 技术改进

### 后端 API 支持

- **动态 API 地址**：
  - 新增 `getFofaApiBaseUrl()` 函数
  - 根据设置动态返回 API 基础 URL
  - 所有 FOFA API 调用（search、stats、getUserInfo、getHost）均支持自定义地址
  - 在日志中输出使用的 API URL，便于调试

### 配置存储

- **新增配置项**：
  - `fofaCustomApi`：是否启用自定义 API（布尔值）
  - `fofaApiProtocol`：API 协议（https/http）
  - `fofaApiDomain`：API 域名（如：fofa.info）
  - 默认使用官方 API：`https://fofa.info/api/v1`

## 📝 国际化

### 完整多语言支持

- 为所有 12 种语言添加了完整翻译：
  - 中文简体 (zh-CN)
  - 中文繁体 (zh-HK)
  - 英文 (en-US)
  - 日文 (ja-JP)
  - 韩文 (ko-KR)
  - 德语 (de-DE)
  - 西班牙语 (es-ES)
  - 法语 (fr-FR)
  - 意大利语 (it-IT)
  - 葡萄牙语 (pt-PT)
  - 俄语 (ru-RU)
  - 印地语 (hi-IN)

### 新增翻译项

- `settings.fofa.customApi` - 自定义 FOFA API
- `settings.fofa.customApiDesc` - 功能描述
- `settings.fofa.apiProtocol` - API 协议
- `settings.fofa.apiDomain` - API 域名
- `settings.fofa.apiDomainPlaceholder` - 域名占位符
- `settings.fofa.apiDomainHint` - 输入提示
- `common.preview` - 预览

## 🎯 使用场景

### 适用情况

1. **私有部署**：企业内部部署的 FOFA 服务
2. **镜像服务**：使用 FOFA 镜像加速访问
3. **测试环境**：连接测试服务器进行开发调试
4. **特殊网络**：在特定网络环境下使用代理或中转服务

### 配置示例

- 官方服务：`https://fofa.info/api/v1`（默认）
- 私有部署：`https://fofa.company.com/api/v1`
- 本地测试：`http://localhost:8080/api/v1`

---

## 升级说明

本次更新增加了自定义 FOFA API 功能，建议需要使用私有部署或镜像服务的用户更新。更新后：

1. 在设置页面可以配置自定义 FOFA API 地址
2. 支持 HTTPS 和 HTTP 协议
3. 所有 FOFA 功能（搜索、统计、用户信息等）都会使用自定义 API
4. 默认仍使用官方 API，不影响现有用户

## 已知问题

无

---

**完整更新内容请查看 [GitHub Releases](https://github.com/MoLeft/React2Shell-Toolbox/releases/tag/v1.1.6)**
