# v1.1.0 更新说明

## 🎉 重大更新

### GitHub OAuth2 授权系统

这是一个重大的架构升级版本，将高级功能解锁机制从密码验证升级为 GitHub OAuth2 授权验证。

- **GitHub OAuth2 集成**
  - 使用 GitHub 账号授权登录
  - 自动检测用户是否 Star 了项目
  - Star 项目即可解锁高级功能
  - 支持自定义 URL Scheme (`r2stb://`) 回调
  - 开发环境和生产环境完美支持

- **授权流程优化**
  - 在浏览器中完成 GitHub 授权
  - 授权后自动返回应用
  - 实时显示授权状态（等待授权、获取信息、保存信息）
  - 授权信息持久化保存

- **Star 状态验证**
  - 应用启动时隐式验证 Star 状态
  - 检测到取消 Star 时弹出提示对话框
  - 自动禁用高级功能防止配置文件篡改
  - 支持在设置中重新验证

- **用户信息展示**
  - 显示 GitHub 用户名和头像
  - 实时显示授权状态和解锁状态
  - 支持取消授权并重新授权

## ✨ 新功能

### 高级功能授权界面

- **未授权状态**
  - 清晰的授权引导提示
  - 显示解锁后可享受的 4 大功能
  - 一键 GitHub 授权按钮
  - 实时授权状态提示（等待网页授权、授权成功等）

- **已授权但未 Star**
  - 显示用户头像和用户名
  - 提示前往 GitHub Star 项目
  - 一键前往 GitHub 按钮
  - 重新验证按钮

- **已授权且已 Star**
  - 显示解锁成功状态
  - 用户信息展示
  - 高级功能配置选项
  - 取消授权按钮

### 自动更新优化

- **检查更新体验提升**
  - 启用自动检查更新时显示 loading snackbar
  - 禁用自动检查更新时静默检查
  - 优化更新检查流程和提示

### PRO 徽章状态

- **侧边栏 PRO 徽章**
  - 未解锁时显示灰色徽章
  - 已解锁时显示蓝色发光徽章
  - 鼠标悬停显示解锁状态和用户名

## 🎨 界面优化

### 授权状态提示

- **动态状态显示**
  - 授权中：显示 loading 图标和状态文本
  - 不同阶段显示不同提示内容
  - 按钮禁用状态优化

- **提示内容优化**
  - "等待网页授权..." → 引导用户在浏览器中授权
  - "授权成功，正在获取信息..." → 提示正在获取账号信息
  - "正在保存授权信息..." → 提示正在保存配置
  - "授权成功！" → 授权流程完成

### 设置页面重构

- **GitHub 授权集成到高级设置**
  - 不再是独立的设置分类
  - 直接在高级功能页面显示授权状态
  - 简化设置页面结构

- **功能列表展示**
  - 未授权时在提示框中显示 4 大功能
  - 使用 Vuetify 原生组件和样式
  - 移除冗余的提示信息

## 🐛 Bug 修复

### URL Scheme 注册问题

- **开发环境 URL Scheme 支持**
  - 修复开发环境下 URL Scheme 无法注册的问题
  - 使用 `process.cwd()` 正确获取项目路径
  - 支持 Windows、macOS、Linux 三平台
  - 开发和生产环境统一处理逻辑

### 协议回调处理

- **跨平台回调支持**
  - Windows/Linux: 通过 `second-instance` 事件处理
  - macOS: 通过 `open-url` 事件处理
  - 统一的回调处理函数
  - 自动聚焦窗口

### Linux 构建产物命名

- **修复 tar.gz 命名问题**
  - 统一 Linux 所有格式的命名规则
  - tar.gz 现在使用正确的命名格式
  - 与 AppImage 和 deb 保持一致

## 🔧 技术改进

### 后端架构

- **GitHub OAuth 处理器**
  - 新增 `github-oauth-handler.js` 模块
  - 完整的 OAuth2 授权流程实现
  - GitHub API 请求封装
  - Star 状态检查和 Token 验证
  - 超时处理和错误处理

- **URL Scheme 注册**
  - 跨平台 URL Scheme 注册
  - 开发环境特殊处理
  - 单实例锁定机制
  - 协议 URL 解析和路由

### 前端架构

- **Settings Store 扩展**
  - GitHub 授权状态管理
  - Token、用户名、头像存储
  - 授权流程状态回调
  - Star 状态验证方法
  - 强制禁用高级功能方法

- **App.vue 启动验证**
  - 应用启动时验证 Star 状态
  - 隐式检查，不显示 loading
  - 检测到取消 Star 时弹出 dialog
  - 自动禁用高级功能

### Electron Builder 配置

- **协议注册配置**
  - 在 `electron-builder.yml` 中注册 `r2stb://` 协议
  - Windows、macOS、Linux 全平台支持
  - 生产环境自动注册

- **Linux 构建优化**
  - 统一 `linux.artifactName` 配置
  - 支持 AppImage、deb、tar.gz 三种格式
  - 修复 tar.gz 命名问题

## 📦 依赖更新

无新增依赖，使用 Node.js 内置的 `https` 模块实现 GitHub API 请求。

## 📝 使用说明

### GitHub 授权流程

1. 进入"设置 → 高级功能"页面
2. 点击"使用 GitHub 授权"按钮
3. 在浏览器中完成 GitHub 授权
4. 浏览器提示"尝试打开应用"时点击"打开"
5. 应用自动获取授权信息并检查 Star 状态
6. 如果已 Star 项目，高级功能自动解锁

### Star 项目解锁

1. 前往 [GitHub 项目页面](https://github.com/MoLeft/React2Shell-Toolbox)
2. 点击右上角的 ⭐ Star 按钮
3. 返回应用，在"高级功能"页面点击"重新验证"
4. 验证通过后高级功能解锁

### 取消授权

1. 在"高级功能"页面点击"取消授权"按钮
2. 授权信息将被清除
3. 高级功能自动禁用
4. 可以重新授权

## 🔒 安全机制

### 防篡改保护

- **启动时验证**
  - 应用每次启动时验证 Star 状态
  - 防止用户修改配置文件绕过验证
  - 检测到异常时自动禁用高级功能

- **Token 验证**
  - 验证 GitHub Token 是否有效
  - Token 失效时自动清除授权信息
  - 需要重新授权

### 隐私保护

- **本地存储**
  - GitHub Token 仅存储在本地配置文件
  - 不上传到任何服务器
  - 用户可随时取消授权

- **最小权限**
  - 仅请求 `user:email` 权限
  - 只读取用户基本信息和 Star 状态
  - 不修改任何 GitHub 数据

## ⚠️ 重要变更

### 高级功能解锁方式变更

- **旧版本（v1.0.x）**: 使用密码解锁
- **新版本（v1.1.0）**: 使用 GitHub OAuth2 + Star 验证

### 配置文件变更

新增配置项：
- `githubToken`: GitHub 访问令牌
- `githubUsername`: GitHub 用户名
- `githubAvatar`: GitHub 头像 URL
- `isGithubAuthorized`: 是否已授权 GitHub

旧配置项保持兼容，但高级功能解锁状态会在启动时重新验证。

## 🎯 已知问题

- 开发环境下首次授权可能需要重启应用（已通过 URL Scheme 修复）
- GitHub API 请求受限于网络环境，国内用户可能需要代理

## 🔮 下个版本计划

- 完成批量验证的资产列表展示
- 实现批量 POC 检测功能
- 支持并发检测和进度跟踪
- 添加检测结果导出功能
- 优化 GitHub 授权流程
- 添加更多高级功能

## 🙏 致谢

感谢所有 Star 本项目的用户！你们的支持是我们持续更新的动力。

---

**升级提示**: 从 v1.0.x 升级到 v1.1.0 后，需要重新使用 GitHub 授权解锁高级功能。
