# v1.1.7 更新日志

发布日期：2025-12-22

## ✨ 新功能

### 开发者选项

- **日志查看器**：
  - 新增可拖动的日志入口按钮（圆角矩形，半透明灰色）
  - 支持鼠标和触摸拖动，自动限制在窗口范围内
  - 实时显示应用日志（主进程和渲染进程）
  - 支持按日志级别过滤（DEBUG、INFO、SUCCESS、WARNING、ERROR）
  - 支持搜索日志内容
  - 支持清空日志和导出日志
  - 支持自动滚动到最新日志
  - 点击日志条目查看详细信息
  - 使用 Vuetify 原生组件，简洁美观

- **内置控制台 (Eruda)**：
  - 集成 Eruda 调试工具及 5 个插件
  - 支持 Vue 组件调试 (eruda-vue)
  - 支持性能监控 (eruda-monitor)
  - 支持功能检测 (eruda-features)
  - 支持性能基准测试 (eruda-benchmark)
  - 支持页面加载时序分析 (eruda-timing)
  - 在应用启动时自动初始化（如果已启用）
  - 修复 CSP 策略，添加 `blob:` 支持

- **开发者工具快捷键**：
  - 新增"启用开发者工具"开关
  - 开启后可通过 F12 快捷键打开/关闭开发者工具
  - 支持在应用的任何页面使用 F12
  - 关闭开关时自动禁用快捷键并关闭已打开的开发者工具
  - 设置在应用重启后保持

## 🎨 界面优化

### 开发者设置页面

- **新增开发者选项分类**：
  - 在设置页面新增"开发者"分类
  - 包含三个开关：启用日志显示、启用内置控制台、启用开发者工具
  - 每个选项都有清晰的描述说明

### 日志查看器样式

- **仿 Eruda 入口设计**：
  - 圆角矩形按钮（44x44px，border-radius: 10px）
  - 半透明灰色背景：`rgba(128, 128, 128, 0.75)`
  - 毛玻璃效果：`backdrop-filter: blur(10px)`
  - 可自由拖动到屏幕任意位置
  - 区分拖动和点击事件，避免误触

- **日志对话框优化**：
  - 使用 `v-dialog` 替代固定定位
  - 优化颜色对比度，提高可读性
  - log-message: `rgba(var(--v-theme-on-surface), 0.95)`
  - log-time: `rgba(var(--v-theme-on-surface), 0.7)`
  - log-details: 深色背景 `rgba(0, 0, 0, 0.6)` 配浅色文字 `rgba(255, 255, 255, 0.9)`
  - 简化界面，移除冗余功能

## 🔧 技术改进

### 日志系统

- **日志收集机制**：
  - 新增 `enableLogCollection()` 和 `disableLogCollection()` 函数
  - 根据设置动态启用/禁用日志收集
  - 在 App.vue 中监听日志开关变化
  - 避免不必要的内存占用

### IPC 通信

- **开发者工具 API**：
  - 主进程：`devTools:setEnabled` handler
  - 使用 `before-input-event` 监听 F12 按键
  - 自动为新创建的窗口添加监听器
  - Preload：暴露 `devTools.setEnabled()` API
  - 渲染进程：在 App.vue 启动时初始化开发者工具状态

### CSP 策略

- **修复内容安全策略**：
  - 在 `src/renderer/index.html` 中添加 `blob:` 支持
  - `script-src * 'unsafe-inline' 'unsafe-eval' blob:`
  - `frame-src * blob:`
  - 解决 Eruda 加载失败的问题

## 📝 国际化

### 完整多语言支持

- 为所有 12 种语言添加了完整翻译：
  - 中文简体 (zh-CN)
  - 中文繁体 (zh-HK)
  - 英文 (en-US)
  - 日文 (ja-JP)
  - 韩文 (ko-KR)
  - 德语 (de-DE)
  - 西班牙语 (es-ES)
  - 法语 (fr-FR)
  - 意大利语 (it-IT)
  - 葡萄牙语 (pt-PT)
  - 俄语 (ru-RU)
  - 印地语 (hi-IN)

### 新增翻译项

**开发者选项**：
- `settings.categories.developer` - 开发者
- `settings.developer.title` - 开发者选项
- `settings.developer.enableLogs` - 启用日志显示
- `settings.developer.enableLogsDesc` - 在应用中显示实时日志查看器
- `settings.developer.enableConsole` - 启用内置控制台
- `settings.developer.enableConsoleDesc` - 启用 Eruda 调试工具（包含 Vue、性能监控等插件）
- `settings.developer.enableDevTools` - 启用开发者工具
- `settings.developer.enableDevToolsDesc` - 允许使用 F12 快捷键打开开发者工具

**日志查看器**：
- `developer.logViewer.title` - 日志查看器
- `developer.logViewer.search` - 搜索日志
- `developer.logViewer.level` - 日志级别
- `developer.logViewer.process` - 进程
- `developer.logViewer.clear` - 清空日志
- `developer.logViewer.export` - 导出日志
- `developer.logViewer.autoScroll` - 自动滚动
- `developer.logViewer.total` - 共 {count} 条日志
- `developer.logViewer.main` - 主进程
- `developer.logViewer.renderer` - 渲染进程

### i18n 配置修复

- 在 `src/renderer/src/locales/index.js` 中添加了 'zh' 作为 'zh-CN' 的别名
- 解决了 `[intlify] Not found 'xxx' key in 'zh' locale messages` 警告

## 🎯 使用场景

### 适用情况

1. **开发调试**：开发者可以实时查看应用日志，快速定位问题
2. **性能分析**：使用 Eruda 的性能监控和基准测试功能
3. **Vue 调试**：使用 Eruda Vue 插件查看组件状态
4. **问题排查**：用户可以导出日志文件，方便提交 issue 时附带详细信息
5. **快速开发**：使用 F12 快捷键快速打开开发者工具

### 使用方法

1. **启用日志查看器**：
   - 进入设置 → 开发者选项
   - 开启"启用日志显示"
   - 屏幕右下角会出现日志入口按钮
   - 点击按钮打开日志查看器

2. **启用内置控制台**：
   - 进入设置 → 开发者选项
   - 开启"启用内置控制台"
   - 屏幕右下角会出现 Eruda 入口按钮
   - 点击按钮打开调试面板

3. **启用开发者工具**：
   - 进入设置 → 开发者选项
   - 开启"启用开发者工具"
   - 在应用的任何页面按 F12 打开/关闭开发者工具

---

## 升级说明

本次更新新增了完整的开发者工具支持，建议开发者和需要调试的用户更新。更新后：

1. 可以实时查看应用日志，方便问题排查
2. 可以使用 Eruda 调试工具进行深度调试
3. 可以使用 F12 快捷键快速打开开发者工具
4. 所有开发者功能默认关闭，不影响普通用户使用

## 已知问题

无

---

**完整更新内容请查看 [GitHub Releases](https://github.com/MoLeft/React2Shell-Toolbox/releases/tag/v1.1.7)**
